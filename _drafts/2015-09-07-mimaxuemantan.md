---
layout: postlayout
title: 密码学漫谈
categories: [IOS]
tags: [objective-c,ios]
---

密码学是个很深奥的学科，包含许多数论的理论，然而本文并不谈数学，本文从实际出发，谈一谈密码学在应用领域究竟是怎么体现的。可以毫不夸张的说，如果没有密码学，就没有如今繁荣的电子商务和互联网时代。本文会涉及到几个关键的概念：非对称加密、对称加密、散列变换等。


## 为什么会有密码学

为了了解这些复杂的概念，首先要知道为什么会有密码学。自从人类意识到信息保密的意义开始，就有了密码学。人们在交换信息的过程中，为了让信息不被他人获得并泄露，发明了将消息通过某种规律变成另一个好不相干的消息体，然后接受方通过相同的规律反过来解出真正的消息，这就是原始的加密体系。在战争中，这种机制普遍使用，比如使用电报在传输消息时，为了防止中途电报被捕获，电报的报文本身需要通过字典来反解才能还原。下图是德军的恩尼格码密码机：

![](pchou.qiniudn.com/mimaxuemantan-00.jpg)

在这个模型中：原始的消息称为`“明文”`，通过字典加密后得到的用于传输的消息称为`“密文”`，字典本身或者用来将明文和密文中来回转换的关键参数称为`“密钥”`，而转换方法称为`“算法”`。有了这4个要素，就形成了一个加密和解密的体系。密码学就此拉开序幕。

然而，如今我们再也不会使用电报来传送数据，取而代之的是电脑、手机、网线、交换机、路由等网络设置和终端，并通过有线或者无线介质来传递数据。但是，数据仍然是很容易被截获，甚至是篡改的，尽管大部分人不知道如何做。从模型的角度看，明文、密文是变化的，是人们的信息本身，并无规律可寻，而密钥、算法是有限的，值得研究的。因此，密码学的研究重点就是密钥和算法。另一方面，究竟什么叫明文，什么叫密文，也不再以人类是否能够读懂作为边界，因为我们有了计算机，如果计算机能读懂，他们计算机也有能力将消息变为人们可以读懂的信息。因此，明文和密文的边界变成了机器能不能读懂。


## 想要保护先想办法攻击

要保护某个东西，通常我们会先想出各种攻击方法，而后，根据这些攻击手段来设计防御方法。那么我们先看看对于消息的保密性，我们先看看我们到底在畏惧些什么：

1. 被截获并泄露秘密数据。这很常见，比如我们怕电话被偷听、银行卡密码在交易过程中被窃取。
2. 被截获并篡改数据。跟1不同，我们并不关心数据是否被别人看见，而是关心数据是否准确的送达对方。比如在汇款时，对于金额无所谓有没有被人看见，而怕被人为改动（被改了岂不是要死人了！）。
3. 我的网站密码会不会被人看到，从而被人家看到私密相册？

对于3，不属于密码学，而属于社会工程学范畴。比如之前CSDN数据库泄露大量用户信息的事件。

1和2都有对应的解决办法，而这些解决办法，从本质上讲都是利用了密码学的原理。那么究竟如何解决1和2这两个问题呢？

## 现实生活中怎么做

为了引出复杂的概念，我们先看看现实生活中我们如何保护自己的信息。如果我们要传递一个机密文件，不能被其他人看到其中的信息，怎么办？你是否会想到，用一个保险柜，把文件放进去，开锁的密码只有你和对方知道，然后托人送过去，运送的人不知道密码自然无法打开保险柜，里面的信息自然不会泄露。当然也不可能篡改。然而，问题来了，你如何告知对方保险柜的密码呢？通过电话，通过QQ，通过微信？别天真了！这些手段在极端情况下，你的保险柜密码都会被中途截获的。好的，我们先搁置这个问题，看看另一个场景。

如果你想给另一个人捎个口信，告诉她晚上6:00看电影，看起来这不是什么见不得人的事情，你希望中间人帮你捎过去，但是呢，你怎么防止中间人故意把6:00说成7:00呢。好，你说把时间写在纸上，你的笔迹，你的签名。看起来无懈可击，但不要忘了，前提是中间人无法模仿你的笔迹和你的签名。当然，现实生活中，我们使用签名和公章等方法来确保文件的有效性是很常见的。

通过这两个现实生活中的解决方案，我们提取其中的关键点：保险柜、签名，这两个分别用来防止偷窥和篡改。在密码学的世界里，这两个原理仍然适用，但是由于计算机世界的特殊性，会有所变化。计算机世界跟现实世界的主要区别在于，计算机事件是数字的、离散的，而现实世界是模拟的，是连续的。相比于现实生活，在计算机世界模仿和篡改是非常容易的。

## 保险柜 - 对称加密

保险柜就是通过同一个密码可以打开的一个装置，对于发送方和接收方，使用同一个密码可以打开这个保险柜，这里的密码就是密钥，所以称为`对称密钥`，而相应的算法称为`对称加密算法`，这个算法是一类算法的统称。

## 签名 - 非对称加密

上面说了，计算机世界是很容易模仿和复制的，我们如何实现像现实中的签名那样的“独一无二”呢？那么现在隆重介绍“非对称加密算法”，这个算法也是一类算法的统称。可以说，这个算法是世界上最重要的算法之一，绝对排在前5没有问题。顾名思义，这个算法有如下特点，每个特点都十分重要：

1. 算法中有两个不同的密钥（非对称）
2. 一个密钥是私有保存的，称为私钥，一个密钥是公开的，称为公钥（所以也要公钥密码算法）
3. 通过私钥能且只能生成唯一的一个公钥与之对应，而通过公钥无法算出私钥，或者很难算出私钥（有多难，非常难！！）
4. 用私钥加密的密文，只能通过对应的公钥解密；反过来，通过公钥加密的密文，只能通过私钥解密

如果您没有仔细体会上面的4点，那么请再仔细体会一下，这4点十分重要，分别用在不同的地方有奇效！

好，基于上面的4点，我们来考虑一下有什么用。

1. 首先，我可以持有一个私钥`S`，算出公钥`A`。让其他想给我发信息的人使用公钥`A`加密，由于只有我拥有私钥`S`，所以根据3，只有我才能解密得到明文。这是不是解决了上面说的保险柜密码怎么告知对方的问题？因为公钥`S`是公开的，谁看见都无所谓！
2. 其次，我可以持有一个私钥`S`，算出公钥`A`。我想签名一份合同，我先想一个词：`鸡肋`！ 我将`鸡肋`用私钥`S`加密，然后合同明文+`鸡肋`+加密过的`鸡肋`一起发出去，接受方只要用公钥将加密过的`鸡肋`解密，看得到的是不是第二项`鸡肋`就可以验证这个签名是我的，而不是别人的。因为根据3，只有我拥有公钥`A`所对应的私钥`S`，不是吗？

看！通过非对称加密算法，我至少同时设计出了保险柜和签名两种机制。看起来十分完美，似乎不需要对称加密了啊！然而非对称加密的主要问题是加密和解密的速度远比对称加密慢很多。

至于世界上为什么会有这么神奇的算法，那么请去研究数论吧，这里不再深入下去了。

事实上，上面的机制2有一个漏洞。合同的正文可以被篡改啊！！比如说好的金额100w，改成个1000w，岂不是要命了？！那么可以考虑将正文也通过私钥加密一下啊，不就万事大吉了。那么别忘了正文可能很长，再加上加密本身速度慢，那么可能时间太长。于是引出下面的概念散列变换。

## 化繁为简 - 散列变换

又是一个神奇的算法：世间万物，任何一个信息，都有且只有一个与之对应的字符串（固定长度的）可以表示：

1. 不存在两个不同的事物，对应同一个字符串
2. 不存在两个不同的字符串，对应同一个事物
3. 通过字符串无法反推出事物本身

听起来就不太靠谱！世间万物是无限的，而字符串的长度是固定的，即字符串的范围是有限的，有限的东西怎么容纳无限的世界呢？

好了，别管这么多了，举几个栗子：

1. 我们可以把用户的密码通过散列变换，算成一个字符串，存起来，由于3，即使字符串被人偷取了，他也无法得知用户真实的密码。而我们只要将用户登录时输入的密码，通过散列变换得到的字符串，跟保存的字符串做的对比就可以知道密码是否正确了（根据1），根本不需要知道密码本身
2. 可以把合同文本通过散列变换，得到一个短很多的字符串，如果合同内容变化了，通过相同散列变换得到的字符串必然变化（根据1）。那么就表示这个字符串可以表示这个合同的内容，所以我们只要加密这个字符串就可以了，所以这个字符串也叫`摘要`。





